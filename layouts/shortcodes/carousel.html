{{ $project := .Get "project" | default "credit-market-volatility-research" }}
{{ $images := slice }}
{{ if eq $project "credit-market-volatility-research" }}
  {{ $images = slice "Stats_of_Key_Variables.png" "Stats_by_Asset.png" "Panel_Data.png" "Quintile_Regression_Bitcoin.png" "Quintile_Regression_Nasdaq.png" "py_plot_L_baa_aaa_spread.png" "py_plot_L_treasury_spread.png" "py_plot_L_implied_vol.png" "py_plot_L_neg_log_ret.png" }}
{{ else if eq $project "futures_vpoc_backtest" }}
  {{ $images = slice "strategy_comparison.png" }}
{{ end }}
{{ if eq $project "futures_vpoc_backtest" }}
  <div style="max-width:800px;margin:auto;text-align:center;display:flex;flex-direction:column;align-items:center;">
    <img id="vpoc-img" src="/images/projects/{{ $project }}/{{ index $images 0 }}" alt="{{ index $images 0 }}" style="max-width:100%;max-height:200px;height:auto;object-fit:contain;cursor:pointer;display:block;margin:0 auto;" onclick="openModal(this.src, this.alt)">
    <div style="font-size:0.85em;color:#888;margin-top:4px;">Click Me <span style="font-size:1.2em;vertical-align:middle;">&#8593;</span></div>
  </div>
{{ else }}
  <div class="glider-contain" style="max-width:800px;margin:auto;">
    <div class="glider" style="height:220px;display:flex;align-items:center;">
      {{ range $img := $images }}
        <img src="/images/projects/{{ $project }}/{{ $img }}" alt="{{ $img }}" style="max-width:100%;max-height:200px;height:auto;object-fit:contain;cursor:pointer;" onclick="openModal(this.src, this.alt)">
      {{ end }}
    </div>
    <button aria-label="Previous" class="glider-prev">«</button>
    <button aria-label="Next" class="glider-next">»</button>
    <!-- Removed dots for page indicators -->
  </div>
{{ end }}
<!-- Modal for enlarged image -->
<div id="carouselModal" style="display:none;position:fixed;z-index:9999;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.85);align-items:center;justify-content:center;">
  <img id="modalImg" src="" alt="" style="max-width:90vw;max-height:90vh;box-shadow:0 0 32px #000;display:block;margin:auto;">
</div>

{{ if not (eq $project "futures_vpoc_backtest") }}
<div style="text-align:center;font-size:0.85em;color:#888;margin-top:4px;">
  <span style="font-size:1.2em;vertical-align:middle;">&#8592;</span>
  <span style="margin:0 8px;">Scroll</span>
  <span style="font-size:1.2em;vertical-align:middle;">&#8594;</span>
</div>
{{ end }}
<script>
var modalCurrentIndex = 0;
var modalImages = [];
function openModal(src, alt) {
  var modal = document.getElementById('carouselModal');
  var img = document.getElementById('modalImg');
  img.src = src;
  img.alt = alt;
  modal.style.display = 'flex';
  // For VPOC, just set single image
  var vpocImg = document.getElementById('vpoc-img');
  if (vpocImg && src === vpocImg.src) {
    modalImages = [vpocImg];
    modalCurrentIndex = 0;
    return;
  }
  // For carousel, find all images
  modalImages = Array.from(document.querySelectorAll('.glider img'));
  modalCurrentIndex = modalImages.findIndex(function(i){ return i.src === img.src || i.getAttribute('src') === img.src; });
}
document.addEventListener('DOMContentLoaded', function() {
  var modal = document.getElementById('carouselModal');
  modal.addEventListener('click', function(e) {
    if (e.target === modal || e.target === document.getElementById('modalImg')) {
      modal.style.display = 'none';
    }
  });
  // Initialize Glider.js carousel
  var gliderElem = document.querySelector('.glider');
  if (gliderElem && typeof Glider !== 'undefined') {
    window._gliderInstance = new Glider(gliderElem, {
      slidesToShow: 1,
      slidesToScroll: 1,
      draggable: true,
      arrows: {
        prev: '.glider-prev',
        next: '.glider-next'
      },
      dots: '.dots'
    });
  }
});

document.addEventListener('keydown', function(e) {
  var modal = document.getElementById('carouselModal');
  var isModalOpen = modal && modal.style.display === 'flex';
  var gliderElem = document.querySelector('.glider');
  // Modal image navigation
  if (isModalOpen && modalImages.length > 0) {
    if (e.key === 'ArrowLeft') {
      if (modalCurrentIndex > 0) {
        modalCurrentIndex--;
        var img = document.getElementById('modalImg');
        img.src = modalImages[modalCurrentIndex].src;
        img.alt = modalImages[modalCurrentIndex].alt;
      }
      e.preventDefault();
      return;
    }
    if (e.key === 'ArrowRight') {
      if (modalCurrentIndex < modalImages.length - 1) {
        modalCurrentIndex++;
        var img = document.getElementById('modalImg');
        img.src = modalImages[modalCurrentIndex].src;
        img.alt = modalImages[modalCurrentIndex].alt;
      }
      e.preventDefault();
      return;
    }
    if (e.key === 'Escape') {
      modal.style.display = 'none';
      e.preventDefault();
      return;
    }
  }
  // Keyboard navigation for Glider.js
  if (gliderElem && typeof Glider !== 'undefined' && window._gliderInstance) {
    if (e.key === 'ArrowLeft') {
      window._gliderInstance.scrollItem('prev');
    }
    if (e.key === 'ArrowRight') {
      window._gliderInstance.scrollItem('next');
    }
  }
});
</script>
